/*
 {
 "receiptNo": "PL20170000002",
 "registrationID": "000001-01-15",
 "receiptDateTime": "2017-07-14T16:54:42.007",
 "referredByName": "Md. Abul Khair ( MBBS,D-CARD(NICVD),FCPS(CARDIOLOGY) )",
 "testBillAmount": 4450,
 "receivableAmount": 4450,
 "totalReceivedAmount": 0,
 "currentDueAmount": 4450,
 "labTestReportInfos": [
     {
         "reportNo": "PLR201700000050",
         "receiptNo": "PL20170000002",
         "charge": 300,
         "deliveryDateTime": null,
         "reportDateTime": "2017-07-14T16:54:42.017",
         "labTestGroupInfo": null,
         "testServiceLabTestServiceInfo": {
             "testID": "LT000003",
             "testName": "TC/DC",
             "charge": 300,
             "labMachineInfo": null,
             "labReportStyle": {
                 "reportStyleID": 2,
                 "reportDescription": "Non-descriptive With Unit and Referrence Range"
             },
             "labReportTitle": {
                 "reportTitleID": 3,
                 "reportTitleName": "Haematology Report"
             },
             "labSpecimen": {
                 "specimenID": 2,
                 "specimenName": "Blood"
             },
             "labTestServiceItemInfos": [
                 {
                     "reportingServiceName": "Total WBC Count",
                     "unit": "/cmm",
                     "defaultResult": "",
                     "refferenceRange": "4000- 11000"
                 },
                 {
                     "reportingServiceName": "Neutrophils",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "40 – 75 %"
                 },
                 {
                     "reportingServiceName": "Lymphocytes",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "20 – 50 %"
                 },
                 {
                     "reportingServiceName": "Monocytes",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "1 – 6 %"
                 },
                 {
                     "reportingServiceName": "Eosinophils",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "2 – 10 %"
                 },
                 {
                     "reportingServiceName": "Basophil",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "< 1 %"
                 }
             ]
         },
         "labTestReportServices": [
             {
                 "reportServiceID": "RS20170000073",
                 "testServiceItemID": 25,
                 "reportNo": "PLR201700000050",
                 "result": "2.5",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Total WBC Count",
                     "unit": "/cmm",
                     "defaultResult": "",
                     "refferenceRange": "4000- 11000"
                 }
             },
             {
                 "reportServiceID": "RS20170000074",
                 "testServiceItemID": 26,
                 "reportNo": "PLR201700000050",
                 "result": "25",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Neutrophils",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "40 – 75 %"
                 }
             },
             {
                 "reportServiceID": "RS20170000075",
                 "testServiceItemID": 27,
                 "reportNo": "PLR201700000050",
                 "result": "5",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Lymphocytes",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "20 – 50 %"
                 }
             },
             {
                 "reportServiceID": "RS20170000076",
                 "testServiceItemID": 28,
                 "reportNo": "PLR201700000050",
                 "result": "58",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Monocytes",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "1 – 6 %"
                 }
             },
             {
                 "reportServiceID": "RS20170000077",
                 "testServiceItemID": 29,
                 "reportNo": "PLR201700000050",
                 "result": "54",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Eosinophils",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "2 – 10 %"
                 }
             },
             {
                 "reportServiceID": "RS20170000078",
                 "testServiceItemID": 30,
                 "reportNo": "PLR201700000050",
                 "result": "1",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Basophil",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "< 1 %"
                 }
             }
         ]
     },
     {
         "reportNo": "PLR201700000051",
         "receiptNo": "PL20170000002",
         "charge": 150,
         "deliveryDateTime": null,
         "reportDateTime": "2017-07-14T16:54:42.017",
         "labTestGroupInfo": null,
         "testServiceLabTestServiceInfo": {
             "testID": "LT000006",
             "testName": "HCT/PCV",
             "charge": 150,
             "labMachineInfo": null,
             "labReportStyle": {
                 "reportStyleID": 2,
                 "reportDescription": "Non-descriptive With Unit and Referrence Range"
             },
             "labReportTitle": {
                 "reportTitleID": 3,
                 "reportTitleName": "Haematology Report"
             },
             "labSpecimen": {
                 "specimenID": 2,
                 "specimenName": "Blood"
             },
             "labTestServiceItemInfos": []
         },
         "labTestReportServices": []
     },
     {
         "reportNo": "PLR201700000052",
         "receiptNo": "PL20170000002",
         "charge": 100,
         "deliveryDateTime": null,
         "reportDateTime": "2017-07-14T16:54:42.017",
         "labTestGroupInfo": null,
         "testServiceLabTestServiceInfo": {
             "testID": "LT000008",
             "testName": "ESR",
             "charge": 100,
             "labMachineInfo": null,
             "labReportStyle": {
                 "reportStyleID": 2,
                 "reportDescription": "Non-descriptive With Unit and Referrence Range"
             },
             "labReportTitle": {
                 "reportTitleID": 3,
                 "reportTitleName": "Haematology Report"
             },
             "labSpecimen": {
                 "specimenID": 2,
                 "specimenName": "Blood"
             },
             "labTestServiceItemInfos": [
                 {
                     "reportingServiceName": "ESR (Westergren)",
                     "unit": "mm(1st hr)",
                     "defaultResult": null,
                     "refferenceRange": "Male : 0 –10 <br/> Female : 0 –20"
                 }
             ]
         },
         "labTestReportServices": [
             {
                 "reportServiceID": "RS20170000079",
                 "testServiceItemID": 34,
                 "reportNo": "PLR201700000052",
                 "result": "3.6",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "ESR (Westergren)",
                     "unit": "mm(1st hr)",
                     "defaultResult": null,
                     "refferenceRange": "Male : 0 –10 <br/> Female : 0 –20"
                 }
             }
         ]
     },
     {
         "reportNo": "PLR201700000053",
         "receiptNo": "PL20170000002",
         "charge": 100,
         "deliveryDateTime": null,
         "reportDateTime": "2017-07-14T16:54:42.017",
         "labTestGroupInfo": null,
         "testServiceLabTestServiceInfo": {
             "testID": "LT000009",
             "testName": "RBC-Morphology",
             "charge": 100,
             "labMachineInfo": null,
             "labReportStyle": {
                 "reportStyleID": 3,
                 "reportDescription": "Non-descriptive Without Unit and Referrence Range"
             },
             "labReportTitle": {
                 "reportTitleID": 3,
                 "reportTitleName": "Haematology Report"
             },
             "labSpecimen": {
                 "specimenID": 2,
                 "specimenName": "Blood"
             },
             "labTestServiceItemInfos": [
                 {
                     "reportingServiceName": "RBC",
                     "unit": "",
                     "defaultResult": "Mild anisochromia and anisocytosis total count is reduced, red cells rouleax formation.",
                     "refferenceRange": ""
                 },
                 {
                     "reportingServiceName": "WBC",
                     "unit": "",
                     "defaultResult": "Mature with Increased Distribution of Easinophils",
                     "refferenceRange": ""
                 },
                 {
                     "reportingServiceName": "Platelet",
                     "unit": "",
                     "defaultResult": "Adequate",
                     "refferenceRange": ""
                 },
                 {
                     "reportingServiceName": "Comment",
                     "unit": "",
                     "defaultResult": "Easinophils",
                     "refferenceRange": ""
                 },
                 {
                     "reportingServiceName": "Advice",
                     "unit": "",
                     "defaultResult": "Easinophils",
                     "refferenceRange": ""
                 }
             ]
         },
         "labTestReportServices": [
             {
                 "reportServiceID": "RS20170000080",
                 "testServiceItemID": 35,
                 "reportNo": "PLR201700000053",
                 "result": "Mild anisochromia and anisocytosis total count is reduced, red cells rouleax formation.",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "RBC",
                     "unit": "",
                     "defaultResult": "Mild anisochromia and anisocytosis total count is reduced, red cells rouleax formation.",
                     "refferenceRange": ""
                 }
             },
             {
                 "reportServiceID": "RS20170000081",
                 "testServiceItemID": 59,
                 "reportNo": "PLR201700000053",
                 "result": "Mature with Increased Distribution of Easinophils",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "WBC",
                     "unit": "",
                     "defaultResult": "Mature with Increased Distribution of Easinophils",
                     "refferenceRange": ""
                 }
             },
             {
                 "reportServiceID": "RS20170000082",
                 "testServiceItemID": 60,
                 "reportNo": "PLR201700000053",
                 "result": "Adequate",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Platelet",
                     "unit": "",
                     "defaultResult": "Adequate",
                     "refferenceRange": ""
                 }
             },
             {
                 "reportServiceID": "RS20170000083",
                 "testServiceItemID": 61,
                 "reportNo": "PLR201700000053",
                 "result": "Easinophils",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Comment",
                     "unit": "",
                     "defaultResult": "Easinophils",
                     "refferenceRange": ""
                 }
             },
             {
                 "reportServiceID": "RS20170000084",
                 "testServiceItemID": 62,
                 "reportNo": "PLR201700000053",
                 "result": "Easinophils",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Advice",
                     "unit": "",
                     "defaultResult": "Easinophils",
                     "refferenceRange": ""
                 }
             }
         ]
     },
     {
         "reportNo": "PLR201700000054",
         "receiptNo": "PL20170000002",
         "charge": 100,
         "deliveryDateTime": null,
         "reportDateTime": "2017-07-14T16:54:42.017",
         "labTestGroupInfo": null,
         "testServiceLabTestServiceInfo": {
             "testID": "LT000010",
             "testName": "Bleeding Time (B.T)",
             "charge": 100,
             "labMachineInfo": null,
             "labReportStyle": {
                 "reportStyleID": 2,
                 "reportDescription": "Non-descriptive With Unit and Referrence Range"
             },
             "labReportTitle": {
                 "reportTitleID": 3,
                 "reportTitleName": "Haematology Report"
             },
             "labSpecimen": {
                 "specimenID": 2,
                 "specimenName": "Blood"
             },
             "labTestServiceItemInfos": [
                 {
                     "reportingServiceName": "Bleeding Time (B.T)",
                     "unit": "",
                     "defaultResult": null,
                     "refferenceRange": "2-7 minutes"
                 }
             ]
         },
         "labTestReportServices": [
             {
                 "reportServiceID": "RS20170000085",
                 "testServiceItemID": 40,
                 "reportNo": "PLR201700000054",
                 "result": "3",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Bleeding Time (B.T)",
                     "unit": "",
                     "defaultResult": null,
                     "refferenceRange": "2-7 minutes"
                 }
             }
         ]
     },
     {
         "reportNo": "PLR201700000055",
         "receiptNo": "PL20170000002",
         "charge": 500,
         "deliveryDateTime": null,
         "reportDateTime": "2017-07-14T16:54:42.017",
         "labTestGroupInfo": null,
         "testServiceLabTestServiceInfo": {
             "testID": "LT000011",
             "testName": "Prothombin Time-PT",
             "charge": 500,
             "labMachineInfo": null,
             "labReportStyle": {
                 "reportStyleID": 2,
                 "reportDescription": "Non-descriptive With Unit and Referrence Range"
             },
             "labReportTitle": {
                 "reportTitleID": 3,
                 "reportTitleName": "Haematology Report"
             },
             "labSpecimen": {
                 "specimenID": 2,
                 "specimenName": "Blood"
             },
             "labTestServiceItemInfos": [
                 {
                     "reportingServiceName": "Patient Time",
                     "unit": "Sec",
                     "defaultResult": "",
                     "refferenceRange": ""
                 },
                 {
                     "reportingServiceName": "Control Time",
                     "unit": "Sec",
                     "defaultResult": "",
                     "refferenceRange": ""
                 },
                 {
                     "reportingServiceName": "Ratio",
                     "unit": "",
                     "defaultResult": "",
                     "refferenceRange": ""
                 },
                 {
                     "reportingServiceName": "Index",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": ""
                 },
                 {
                     "reportingServiceName": "INR",
                     "unit": "",
                     "defaultResult": "",
                     "refferenceRange": ""
                 }
             ]
         },
         "labTestReportServices": [
             {
                 "reportServiceID": "RS20170000086",
                 "testServiceItemID": 42,
                 "reportNo": "PLR201700000055",
                 "result": "3.6",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Patient Time",
                     "unit": "Sec",
                     "defaultResult": "",
                     "refferenceRange": ""
                 }
             },
             {
                 "reportServiceID": "RS20170000087",
                 "testServiceItemID": 43,
                 "reportNo": "PLR201700000055",
                 "result": "9.",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Control Time",
                     "unit": "Sec",
                     "defaultResult": "",
                     "refferenceRange": ""
                 }
             },
             {
                 "reportServiceID": "RS20170000088",
                 "testServiceItemID": 44,
                 "reportNo": "PLR201700000055",
                 "result": "10.",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Ratio",
                     "unit": "",
                     "defaultResult": "",
                     "refferenceRange": ""
                 }
             },
             {
                 "reportServiceID": "RS20170000089",
                 "testServiceItemID": 45,
                 "reportNo": "PLR201700000055",
                 "result": "1",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Index",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": ""
                 }
             },
             {
                 "reportServiceID": "RS20170000090",
                 "testServiceItemID": 46,
                 "reportNo": "PLR201700000055",
                 "result": "1",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "INR",
                     "unit": "",
                     "defaultResult": "",
                     "refferenceRange": ""
                 }
             }
         ]
     },
     {
         "reportNo": "PLR201700000056",
         "receiptNo": "PL20170000002",
         "charge": 200,
         "deliveryDateTime": null,
         "reportDateTime": "2017-07-14T16:54:42.017",
         "labTestGroupInfo": null,
         "testServiceLabTestServiceInfo": {
             "testID": "LT000025",
             "testName": "PBF- (Peripheral Blood Film)",
             "charge": 200,
             "labMachineInfo": null,
             "labReportStyle": {
                 "reportStyleID": 3,
                 "reportDescription": "Non-descriptive Without Unit and Referrence Range"
             },
             "labReportTitle": {
                 "reportTitleID": 3,
                 "reportTitleName": "Haematology Report"
             },
             "labSpecimen": {
                 "specimenID": 2,
                 "specimenName": "Blood"
             },
             "labTestServiceItemInfos": [
                 {
                     "reportingServiceName": "Advice",
                     "unit": "",
                     "defaultResult": "Easinophils",
                     "refferenceRange": ""
                 },
                 {
                     "reportingServiceName": "RBC",
                     "unit": "",
                     "defaultResult": "Anisochromic and Anisocytic",
                     "refferenceRange": ""
                 },
                 {
                     "reportingServiceName": "WBC",
                     "unit": "",
                     "defaultResult": "Mature with Increased Distribution of Easinophils",
                     "refferenceRange": ""
                 },
                 {
                     "reportingServiceName": "Platelet",
                     "unit": "",
                     "defaultResult": "Adequate",
                     "refferenceRange": ""
                 },
                 {
                     "reportingServiceName": "Comment",
                     "unit": "",
                     "defaultResult": "Easinophils",
                     "refferenceRange": ""
                 }
             ]
         },
         "labTestReportServices": [
             {
                 "reportServiceID": "RS20170000091",
                 "testServiceItemID": 58,
                 "reportNo": "PLR201700000056",
                 "result": "Easinophils",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Advice",
                     "unit": "",
                     "defaultResult": "Easinophils",
                     "refferenceRange": ""
                 }
             },
             {
                 "reportServiceID": "RS20170000092",
                 "testServiceItemID": 195,
                 "reportNo": "PLR201700000056",
                 "result": "Anisochromic and Anisocytic",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "RBC",
                     "unit": "",
                     "defaultResult": "Anisochromic and Anisocytic",
                     "refferenceRange": ""
                 }
             },
             {
                 "reportServiceID": "RS20170000093",
                 "testServiceItemID": 196,
                 "reportNo": "PLR201700000056",
                 "result": "Mature with Increased Distribution of Easinophils",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "WBC",
                     "unit": "",
                     "defaultResult": "Mature with Increased Distribution of Easinophils",
                     "refferenceRange": ""
                 }
             },
             {
                 "reportServiceID": "RS20170000094",
                 "testServiceItemID": 197,
                 "reportNo": "PLR201700000056",
                 "result": "Adequate",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Platelet",
                     "unit": "",
                     "defaultResult": "Adequate",
                     "refferenceRange": ""
                 }
             },
             {
                 "reportServiceID": "RS20170000095",
                 "testServiceItemID": 198,
                 "reportNo": "PLR201700000056",
                 "result": "Easinophils",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Comment",
                     "unit": "",
                     "defaultResult": "Easinophils",
                     "refferenceRange": ""
                 }
             }
         ]
     },
     {
         "reportNo": "PLR201700000057",
         "receiptNo": "PL20170000002",
         "charge": 400,
         "deliveryDateTime": null,
         "reportDateTime": "2017-07-14T16:54:42.017",
         "labTestGroupInfo": null,
         "testServiceLabTestServiceInfo": {
             "testID": "LT000133",
             "testName": "CBC-CP",
             "charge": 400,
             "labMachineInfo": {
                 "machineID": 3,
                 "machineName": "i1000",
                 "machineDescription": "Estimations are carried out by Sysmex i1000 hematology Analyzer."
             },
             "labReportStyle": {
                 "reportStyleID": 2,
                 "reportDescription": "Non-descriptive With Unit and Referrence Range"
             },
             "labReportTitle": {
                 "reportTitleID": 3,
                 "reportTitleName": "Haematology Report"
             },
             "labSpecimen": {
                 "specimenID": 2,
                 "specimenName": "Blood"
             },
             "labTestServiceItemInfos": [
                 {
                     "reportingServiceName": "Haemoglobin",
                     "unit": "g/dL",
                     "defaultResult": "",
                     "refferenceRange": "Male: 13 – 18, Female: 11 – 16"
                 },
                 {
                     "reportingServiceName": "ESR (Westergren Method)",
                     "unit": "mm(1st hr)",
                     "defaultResult": "",
                     "refferenceRange": "Male: 0 –10, Female: 0 –20"
                 },
                 {
                     "reportingServiceName": "Total WBC Count",
                     "unit": "/cmm",
                     "defaultResult": "",
                     "refferenceRange": "4000- 11000"
                 },
                 {
                     "reportingServiceName": "Neutrophils",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "40 – 75 %"
                 },
                 {
                     "reportingServiceName": "Lymphocytes",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "20 – 50 %"
                 },
                 {
                     "reportingServiceName": "Eosinophils",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "1 – 6 %"
                 },
                 {
                     "reportingServiceName": "Monocytes",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "2 – 10 %"
                 },
                 {
                     "reportingServiceName": "Basophils",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "< 1 %"
                 },
                 {
                     "reportingServiceName": "Total Platelets Count (PC)",
                     "unit": "/cmm",
                     "defaultResult": "",
                     "refferenceRange": "150000- 400000"
                 }
             ]
         },
         "labTestReportServices": [
             {
                 "reportServiceID": "RS20170000096",
                 "testServiceItemID": 67,
                 "reportNo": "PLR201700000057",
                 "result": "",
                 "labTechnologistID": null,
                 "labConsultantID": null,
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Haemoglobin",
                     "unit": "g/dL",
                     "defaultResult": "",
                     "refferenceRange": "Male: 13 – 18, Female: 11 – 16"
                 }
             },
             {
                 "reportServiceID": "RS20170000097",
                 "testServiceItemID": 87,
                 "reportNo": "PLR201700000057",
                 "result": "",
                 "labTechnologistID": null,
                 "labConsultantID": null,
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "ESR (Westergren Method)",
                     "unit": "mm(1st hr)",
                     "defaultResult": "",
                     "refferenceRange": "Male: 0 –10, Female: 0 –20"
                 }
             },
             {
                 "reportServiceID": "RS20170000098",
                 "testServiceItemID": 89,
                 "reportNo": "PLR201700000057",
                 "result": "",
                 "labTechnologistID": null,
                 "labConsultantID": null,
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Total WBC Count",
                     "unit": "/cmm",
                     "defaultResult": "",
                     "refferenceRange": "4000- 11000"
                 }
             },
             {
                 "reportServiceID": "RS20170000099",
                 "testServiceItemID": 273221586,
                 "reportNo": "PLR201700000057",
                 "result": "",
                 "labTechnologistID": null,
                 "labConsultantID": null,
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Neutrophils",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "40 – 75 %"
                 }
             },
             {
                 "reportServiceID": "RS20170000100",
                 "testServiceItemID": 273221587,
                 "reportNo": "PLR201700000057",
                 "result": "",
                 "labTechnologistID": null,
                 "labConsultantID": null,
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Lymphocytes",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "20 – 50 %"
                 }
             },
             {
                 "reportServiceID": "RS20170000101",
                 "testServiceItemID": 273221588,
                 "reportNo": "PLR201700000057",
                 "result": "",
                 "labTechnologistID": null,
                 "labConsultantID": null,
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Eosinophils",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "1 – 6 %"
                 }
             },
             {
                 "reportServiceID": "RS20170000102",
                 "testServiceItemID": 273221589,
                 "reportNo": "PLR201700000057",
                 "result": "",
                 "labTechnologistID": null,
                 "labConsultantID": null,
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Monocytes",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "2 – 10 %"
                 }
             },
             {
                 "reportServiceID": "RS20170000103",
                 "testServiceItemID": 273221590,
                 "reportNo": "PLR201700000057",
                 "result": "",
                 "labTechnologistID": null,
                 "labConsultantID": null,
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Basophils",
                     "unit": "%",
                     "defaultResult": "",
                     "refferenceRange": "< 1 %"
                 }
             },
             {
                 "reportServiceID": "RS20170000104",
                 "testServiceItemID": 273221591,
                 "reportNo": "PLR201700000057",
                 "result": "",
                 "labTechnologistID": null,
                 "labConsultantID": null,
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Total Platelets Count (PC)",
                     "unit": "/cmm",
                     "defaultResult": "",
                     "refferenceRange": "150000- 400000"
                 }
             }
         ]
     },
     {
         "reportNo": "PLR201700000058",
         "receiptNo": "PL20170000002",
         "charge": 150,
         "deliveryDateTime": null,
         "reportDateTime": "2017-07-14T16:54:42.017",
         "labTestGroupInfo": null,
         "testServiceLabTestServiceInfo": {
             "testID": "LT000258",
             "testName": "PCV (Pet Cell Volume)",
             "charge": 150,
             "labMachineInfo": {
                 "machineID": 4,
                 "machineName": "DURUI",
                 "machineDescription": "Estimations are carried out by DURUI urine Analyzer."
             },
             "labReportStyle": {
                 "reportStyleID": 2,
                 "reportDescription": "Non-descriptive With Unit and Referrence Range"
             },
             "labReportTitle": {
                 "reportTitleID": 3,
                 "reportTitleName": "Haematology Report"
             },
             "labSpecimen": {
                 "specimenID": 2,
                 "specimenName": "Blood"
             },
             "labTestServiceItemInfos": []
         },
         "labTestReportServices": []
     },
     {
         "reportNo": "PLR201700000059",
         "receiptNo": "PL20170000002",
         "charge": 250,
         "deliveryDateTime": null,
         "reportDateTime": "2017-07-14T16:54:42.017",
         "labTestGroupInfo": null,
         "testServiceLabTestServiceInfo": {
             "testID": "LT000261",
             "testName": "Reticulocyte Count",
             "charge": 250,
             "labMachineInfo": null,
             "labReportStyle": null,
             "labReportTitle": {
                 "reportTitleID": 3,
                 "reportTitleName": "Haematology Report"
             },
             "labSpecimen": {
                 "specimenID": 2,
                 "specimenName": "Blood"
             },
             "labTestServiceItemInfos": []
         },
         "labTestReportServices": []
     },
     {
         "reportNo": "PLR201700000060",
         "receiptNo": "PL20170000002",
         "charge": 1500,
         "deliveryDateTime": null,
         "reportDateTime": "2017-07-14T16:54:42.017",
         "labTestGroupInfo": null,
         "testServiceLabTestServiceInfo": {
             "testID": "LT000262",
             "testName": "Hb Electrophoresis",
             "charge": 1500,
             "labMachineInfo": null,
             "labReportStyle": null,
             "labReportTitle": {
                 "reportTitleID": 3,
                 "reportTitleName": "Haematology Report"
             },
             "labSpecimen": {
                 "specimenID": 2,
                 "specimenName": "Blood"
             },
             "labTestServiceItemInfos": []
         },
         "labTestReportServices": []
     },
     {
         "reportNo": "PLR201700000061",
         "receiptNo": "PL20170000002",
         "charge": 100,
         "deliveryDateTime": null,
         "reportDateTime": "2017-07-14T16:54:42.017",
         "labTestGroupInfo": null,
         "testServiceLabTestServiceInfo": {
             "testID": "LT000309",
             "testName": "Haemoglobin (HB%)",
             "charge": 100,
             "labMachineInfo": null,
             "labReportStyle": {
                 "reportStyleID": 2,
                 "reportDescription": "Non-descriptive With Unit and Referrence Range"
             },
             "labReportTitle": {
                 "reportTitleID": 3,
                 "reportTitleName": "Haematology Report"
             },
             "labSpecimen": {
                 "specimenID": 2,
                 "specimenName": "Blood"
             },
             "labTestServiceItemInfos": [
                 {
                     "reportingServiceName": "Haemoglobin (Hb)",
                     "unit": "g/dl",
                     "defaultResult": null,
                     "refferenceRange": "Male : 13 – 18 <br/> Female: 11 – 16"
                 }
             ]
         },
         "labTestReportServices": [
             {
                 "reportServiceID": "RS20170000105",
                 "testServiceItemID": 585491390,
                 "reportNo": "PLR201700000061",
                 "result": "15",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Haemoglobin (Hb)",
                     "unit": "g/dl",
                     "defaultResult": null,
                     "refferenceRange": "Male : 13 – 18 <br/> Female: 11 – 16"
                 }
             }
         ]
     },
     {
         "reportNo": "PLR201700000062",
         "receiptNo": "PL20170000002",
         "charge": 400,
         "deliveryDateTime": null,
         "reportDateTime": "2017-07-14T16:54:42.02",
         "labTestGroupInfo": null,
         "testServiceLabTestServiceInfo": {
             "testID": "LT000457",
             "testName": "Complete Blood Count (CBC)",
             "charge": 400,
             "labMachineInfo": null,
             "labReportStyle": {
                 "reportStyleID": 2,
                 "reportDescription": "Non-descriptive With Unit and Referrence Range"
             },
             "labReportTitle": {
                 "reportTitleID": 3,
                 "reportTitleName": "Haematology Report"
             },
             "labSpecimen": {
                 "specimenID": 2,
                 "specimenName": "Blood"
             },
             "labTestServiceItemInfos": []
         },
         "labTestReportServices": []
     },
     {
         "reportNo": "PLR201700000063",
         "receiptNo": "PL20170000002",
         "charge": 200,
         "deliveryDateTime": null,
         "reportDateTime": "2017-07-14T16:54:42.02",
         "labTestGroupInfo": null,
         "testServiceLabTestServiceInfo": {
             "testID": "LT000509",
             "testName": "BT/CT",
             "charge": 200,
             "labMachineInfo": {
                 "machineID": 2,
                 "machineName": "c8000",
                 "machineDescription": "Estimations are carried out by Architect c8000/Beckman coulter AU480 Biochemistry Analyzer."
             },
             "labReportStyle": {
                 "reportStyleID": 2,
                 "reportDescription": "Non-descriptive With Unit and Referrence Range"
             },
             "labReportTitle": {
                 "reportTitleID": 3,
                 "reportTitleName": "Haematology Report"
             },
             "labSpecimen": {
                 "specimenID": 2,
                 "specimenName": "Blood"
             },
             "labTestServiceItemInfos": [
                 {
                     "reportingServiceName": "Bleeding Time (BT)",
                     "unit": "",
                     "defaultResult": null,
                     "refferenceRange": "2-7 Min"
                 },
                 {
                     "reportingServiceName": "Clotting Time (CT)",
                     "unit": "",
                     "defaultResult": null,
                     "refferenceRange": "6-9 Min"
                 }
             ]
         },
         "labTestReportServices": [
             {
                 "reportServiceID": "RS20170000106",
                 "testServiceItemID": 585491398,
                 "reportNo": "PLR201700000063",
                 "result": "2",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Bleeding Time (BT)",
                     "unit": "",
                     "defaultResult": null,
                     "refferenceRange": "2-7 Min"
                 }
             },
             {
                 "reportServiceID": "RS20170000107",
                 "testServiceItemID": 585491399,
                 "reportNo": "PLR201700000063",
                 "result": "1",
                 "labTechnologistID": "E000043",
                 "labConsultantID": "E000001",
                 "labReleasedByID": null,
                 "isResultInputed": true,
                 "labTestServiceItemInfo": {
                     "reportingServiceName": "Clotting Time (CT)",
                     "unit": "",
                     "defaultResult": null,
                     "refferenceRange": "6-9 Min"
                 }
             }
         ]
     }
 ]
}


*/
package com.daffodil.cardiocare;

import android.app.ProgressDialog;
import android.content.Intent;
import android.content.IntentFilter;
import android.net.ConnectivityManager;
import android.os.Build;
import android.support.v7.app.ActionBar;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.support.v7.widget.LinearLayoutManager;
import android.support.v7.widget.RecyclerView;
import android.widget.ImageView;
import android.widget.TextView;

import com.android.volley.AuthFailureError;
import com.android.volley.NetworkResponse;
import com.android.volley.Request;
import com.android.volley.Response;
import com.android.volley.ServerError;
import com.android.volley.VolleyError;
import com.android.volley.toolbox.HttpHeaderParser;
import com.android.volley.toolbox.JsonObjectRequest;
import com.daffodil.cardiocare.Adapter.LabReportAdapter;
import com.daffodil.cardiocare.Models.DetailLabReport;
import com.daffodil.cardiocare.Models.LabReportModel;
import com.daffodil.cardiocare.Models.LoggedpatientDetail;
import com.daffodil.cardiocare.app.AppController;
import com.daffodil.cardiocare.utils.ApiClass;
import com.daffodil.cardiocare.utils.CheckConnectivity;

import org.json.JSONException;
import org.json.JSONObject;

import java.io.UnsupportedEncodingException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

public class LabReportDetailActivity extends AppCompatActivity {
    /*
                           "receiptNo": "PL20170000002",
                                   "registrationID": "000001-01-15",
                                   "receiptDateTime": "2017-07-14T16:54:42.007",
                                   "referredByName": "Md. Abul Khair ( MBBS,D-CARD(NICVD),FCPS(CARDIOLOGY) )",
                                   "testBillAmount": 4450,
                                   "receivableAmount": 4450,
                                   "totalReceivedAmount": 0,
                                   "currentDueAmount": 4450,
   */
    TextView receiptNotv,registrationID,receiptDateTime,referredByName,testBillAmount,receivableAmount,totalReceivedAmount,currentDueAmount,tv;

    ArrayList<DetailLabReport> reportList;
    RecyclerView recyclerView;
    LabReportAdapter adapter;
    LinearLayoutManager linearLayoutManagerDetailLabReport;
    LoggedpatientDetail loggedpatientDetail;
    LabReportModel labReportModel;
    ImageView emptyBox;
    CheckConnectivity checkConnectivity;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        ActionBar actionBar = getSupportActionBar();
        actionBar.setDisplayShowHomeEnabled(true);
        actionBar.setIcon(R.mipmap.ic_launcher_cardiocare);
        actionBar.setTitle("");

        setContentView(R.layout.activity_lab_report_detail);

        reportList = new ArrayList<>();

        receiptNotv = findViewById(R.id.receiptNo);
        registrationID = findViewById(R.id.registrationID);
        receiptDateTime = findViewById(R.id.receiptDateTime);
        referredByName = findViewById(R.id.referredByName);
        testBillAmount = findViewById(R.id.testBillAmount);
        receivableAmount = findViewById(R.id.receivableAmount);
        totalReceivedAmount = findViewById(R.id.totalReceivedAmount);
        currentDueAmount = findViewById(R.id.currentDueAmount);
        recyclerView = findViewById(R.id.recycleLabReportDetail);
        tv = findViewById(R.id.tv);
        emptyBox = findViewById(R.id.empty_box);


        Intent i = getIntent();
        loggedpatientDetail = (LoggedpatientDetail) i.getSerializableExtra("patientObj");
        labReportModel = (LabReportModel) i.getSerializableExtra("reportObj");

        requestForLabReport(loggedpatientDetail.getToken(), labReportModel.getReceiptNo());


        checkConnectivity = new CheckConnectivity();
        registerNetworkBroadcastForNougat();

    }


    @Override
    public void onDestroy() {
        super.onDestroy();
        unregisterNetworkChanges();
    }

    private void registerNetworkBroadcastForNougat() {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {
            registerReceiver(checkConnectivity, new IntentFilter(ConnectivityManager.CONNECTIVITY_ACTION));
        }
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
            registerReceiver(checkConnectivity, new IntentFilter(ConnectivityManager.CONNECTIVITY_ACTION));
        }
    }

    protected void unregisterNetworkChanges() {
        try {
            unregisterReceiver(checkConnectivity);
        } catch (IllegalArgumentException e) {
            e.printStackTrace();
        }
    }


    public void requestForLabReport(final String accesstoken, final String receiptNo){
        // Post request
        String tag_json_obj = "json_obj_req";
        String url = ApiClass.ApiPatientUrl+"api/Labs/"+receiptNo;

        final ProgressDialog pDialog = new ProgressDialog(this);
        pDialog.setMessage("Loading...");
        pDialog.show();

        JsonObjectRequest req = new JsonObjectRequest(Request.Method.GET,
                url, null,
                new Response.Listener<JSONObject>() {

                    @Override
                    public void onResponse(JSONObject response) {

                        pDialog.hide();
                        pDialog.dismiss();


                        try {
                            receiptNotv.setText("Receipt No: "+response.getString("receiptNo"));
                            registrationID.setText("Registration Id: "+response.getString("registrationID"));
                            receiptDateTime.setText("Receipt Date: "+response.getString("receiptDateTime"));
                            referredByName.setText("Referred By: "+response.getString("referredByName"));
                            testBillAmount.setText("Test Bill Amount: "+response.getString("testBillAmount"));
                            receivableAmount.setText("Receivable Amount: "+response.getString("receivableAmount"));
                            totalReceivedAmount.setText("TotalReceived Amount: "+response.getString("totalReceivedAmount"));
                            totalReceivedAmount.setText("Current Due Amount: "+response.getString("currentDueAmount"));

                            for(int i=0 ;i<response.getJSONArray("labTestReportInfos").length();i++){
                                DetailLabReport obj = null;

                                    obj = new DetailLabReport(
                                            response.getJSONArray("labTestReportInfos").getJSONObject(i).getString("reportNo"),
                                            response.getJSONArray("labTestReportInfos").getJSONObject(i).getString("receiptNo"),
                                            response.getJSONArray("labTestReportInfos").getJSONObject(i).getString("charge"),
                                            response.getJSONArray("labTestReportInfos").getJSONObject(i).getString("deliveryDateTime"),
                                            response.getJSONArray("labTestReportInfos").getJSONObject(i).getString("reportDateTime"),
                                            response.getJSONArray("labTestReportInfos").getJSONObject(i).getJSONObject("testServiceLabTestServiceInfo").getJSONObject("labReportTitle").getString("reportTitleName"),
                                            response.getJSONArray("labTestReportInfos").getJSONObject(i).getJSONObject("testServiceLabTestServiceInfo").getJSONObject("labSpecimen").getString("specimenName")

                                    );
                                    reportList.add(obj);
                                }

//                                response.getJSONArray("labTestReportInfos").getJSONObject(i).getJSONArray("labTestReportServices").getJSONObject(0).getString("result")
//                                response.getJSONArray("labTestReportInfos").getJSONObject(i).getJSONArray("labTestReportServices").getJSONObject(0).getJSONObject("labTestServiceItemInfo").getString("reportingServiceName"),
//                                        response.getJSONArray("labTestReportInfos").getJSONObject(i).getJSONArray("labTestReportServices").getJSONObject(0).getJSONObject("labTestServiceItemInfo").getString("unit"),
//                                        response.getJSONArray("labTestReportInfos").getJSONObject(i).getJSONArray("labTestReportServices").getJSONObject(0).getJSONObject("labTestServiceItemInfo").getString("defaultResult"),
//                                        response.getJSONArray("labTestReportInfos").getJSONObject(i).getJSONArray("labTestReportServices").getJSONObject(0).getJSONObject("labTestServiceItemInfo").getString("refferenceRange")

                            } catch (JSONException e) {
                            e.printStackTrace();
                            }

                        adapter = new LabReportAdapter(LabReportDetailActivity.this,reportList,loggedpatientDetail,labReportModel);
                        linearLayoutManagerDetailLabReport = new LinearLayoutManager(LabReportDetailActivity.this,LinearLayoutManager.VERTICAL,false);
                        recyclerView.setLayoutManager(linearLayoutManagerDetailLabReport);
                        recyclerView.setAdapter(adapter);



                    }
                }, new Response.ErrorListener() {

            @Override
            public void onErrorResponse(VolleyError error) {

                pDialog.hide();
                pDialog.dismiss();
                // As of f605da3 the following should work
                NetworkResponse response = error.networkResponse;
                if (error instanceof ServerError && response != null) {
                    try {
                        String res = new String(response.data,
                                HttpHeaderParser.parseCharset(response.headers, "utf-8"));
                        // Now you can use any deserializer to make sense of data
                        JSONObject obj = new JSONObject(res);

                    } catch (UnsupportedEncodingException e1) {
                        // Couldn't properly decode data to string
                        e1.printStackTrace();
                    } catch (JSONException e2) {
                        // returned data is not JSONObject?
                        e2.printStackTrace();
                    }
                }

            }

        })
        {
            /**
             * Passing some request headers
             * */
            @Override
            public Map<String, String> getHeaders() throws AuthFailureError {
                HashMap<String, String> headers = new HashMap<String, String>();
                headers.put("Authorization", "Bearer " + accesstoken);
                return headers;
            }

        };

        // Adding request to request queue
        AppController.getInstance().addToRequestQueue(req, tag_json_obj);

    }
}
